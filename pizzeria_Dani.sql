DROP DATABASE IF EXISTS PIZZERIA_DANI;

CREATE DATABASE PIZZERIA_DANI;

USE PIZZERIA_DANI;

CREATE TABLE PROVINCIA(
    ID_PROVINCIA VARCHAR (2) PRIMARY KEY,
    NOMBRE VARCHAR (20) NOT NULL
);

CREATE TABLE LOCALIDAD(
    ID_LOCALIDAD VARCHAR (5) PRIMARY KEY,
    NOMBRE VARCHAR (20) NOT NULL,
    ID_PROVINCIA VARCHAR (5) NOT NULL,
    FOREIGN KEY (ID_PROVINCIA) REFERENCES PROVINCIA (ID_PROVINCIA)
);

CREATE TABLE TIENDA(
    ID_TIENDA INT PRIMARY KEY AUTO_INCREMENT,
    DIRECCION VARCHAR (100) NOT NULL,
    ID_LOCALIDAD VARCHAR (5) NOT NULL,
    ID_PROVINCIA VARCHAR (2) NOT NULL,
    FOREIGN KEY (ID_LOCALIDAD) REFERENCES LOCALIDAD(ID_LOCALIDAD),
    FOREIGN KEY (ID_PROVINCIA) REFERENCES PROVINCIA(ID_PROVINCIA)
);


CREATE TABLE TRABAJADOR(
    ID_TRABAJADOR INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR (20) NOT NULL,
    APELLIDOS VARCHAR (50) NOT NULL,
    DNI VARCHAR (15) NOT NULL,
    TELEFONO INT (15),
    ROL VARCHAR (15) NOT NULL,
    ID_TIENDA  INT (5) NOT NULL,
    FOREIGN KEY (ID_TIENDA) REFERENCES TIENDA (ID_TIENDA) 
);


CREATE TABLE CLIENTE(
    ID_CLIENTE INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR (20) NOT NULL,
    APELLIDOS VARCHAR (50) NOT NULL,
    DIRECCION VARCHAR (100) NOT NULL,
    ID_LOCALIDAD VARCHAR (5) NOT NULL,
    ID_PROVINCIA VARCHAR (2) NOT NULL,
    TELEFONO INT (15) NOT NULL,
    FOREIGN KEY (ID_LOCALIDAD) REFERENCES LOCALIDAD (ID_LOCALIDAD),
    FOREIGN KEY (ID_PROVINCIA) REFERENCES PROVINCIA (ID_PROVINCIA)
);
CREATE TABLE TIPO_DE_PRODUCTO(
    ID_TIPO_PRODUCTO INT PRIMARY KEY AUTO_INCREMENT,
    TIPO_DE_PRODUCTO VARCHAR (20) NOT NULL
); 
CREATE TABLE CATEGORIA_PIZZAS(
    ID_CATEGORIA INT PRIMARY KEY AUTO_INCREMENT,
    NOMBRE VARCHAR (20) NOT NULL
);

CREATE TABLE PRODUCTO(
    ID_PRODUCTO INT PRIMARY KEY AUTO_INCREMENT,
    TIPO_DE_PRODUCTO INT (20) NOT NULL,
    CATEGORIA INT (20) NULL,
    NOMBRE VARCHAR (20) NOT NULL,
    DESCRIPCION VARCHAR (100) NOT NULL,
    IMAGEN LONGBLOB NULL,
    PRECIO FLOAT (10) NOT NULL,
    FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIA_PIZZAS (ID_CATEGORIA),
    FOREIGN KEY (TIPO_DE_PRODUCTO) REFERENCES TIPO_DE_PRODUCTO (ID_TIPO_PRODUCTO)
);

CREATE TABLE CARRITO(
    ID_CLIENTE INT (5),
    ID_PEDIDO INT (5),
    ID_PRODUCTO INT (5),
    CANTIDAD INT (5),
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE),
    FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTO (ID_PRODUCTO)
);

CREATE TABLE PEDIDO(
    ID_PEDIDO INT PRIMARY KEY AUTO_INCREMENT,
    FECHA_HORA DATETIME,
    ENTREGA_PEDIDO VARCHAR (20),
    TOTAL_HAMBURGUESAS INT (5), 
    TOTAL_BEBIDAS INT (5),
    TOTAL_PIZZAS INT (5),
    PRECIO_TOTAL FLOAT (10),
    ID_TIENDA INT (5),
    ID_CLIENTE INT (5),
    FOREIGN KEY (ID_TIENDA) REFERENCES TIENDA (ID_TIENDA),
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE)
);

CREATE TABLE REPARTO_PEDIDO(
    ID_PEDIDO INT (5) NOT NULL,
    ID_TRABAJADOR INT (5) NOT NULL,
    ID_CLIENTE INT (5) NOT NULL,
    FECHA_HORA DATETIME,
    FOREIGN KEY (ID_PEDIDO) REFERENCES PEDIDO (ID_PEDIDO),
    FOREIGN KEY (ID_TRABAJADOR) REFERENCES TRABAJADOR (ID_TRABAJADOR),
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE)
);

INSERT INTO PROVINCIA (ID_PROVINCIA, NOMBRE)
VALUES
('08', 'BARCELONA'), ('43', 'TARRAGONA'), ('03', 'ALICANTE'), ('09', 'BURGOS'), ('17', 'GERONA');

INSERT INTO LOCALIDAD (ID_LOCALIDAD, NOMBRE, ID_PROVINCIA)
VALUES
('08270', 'NAVARCLES','08'), ('43820', 'CALAFELL', '43'), ('03827', 'ALMUDAINA', '03'), ('09572', 'ARREBA ', '09'), ('17820', 'BANYOLES', '17');

INSERT INTO TIENDA (DIRECCION, ID_LOCALIDAD, ID_PROVINCIA)
VALUES
('C/MONTSERRAT 24', '08270', '08'), ('C/MARIE CURIE 30', '43820', '43'),
('C/ROMA 36', '03827', '03'), ('C/BERLIN 45', '09572', '09'), ('C/CADI', '17820', '17');

INSERT INTO TRABAJADOR (NOMBRE, APELLIDOS, DNI, TELEFONO, ROL, ID_TIENDA)
VALUES
('JUAN', 'MARTIN GONZO', '39284559L', '772974562', 'COCINERO', '1'),
('MARIO', 'MARCO SUAREZ', '39981559R', '772357562', 'REPARTIDOR', '1'),
('MARIA', 'MARTIN MARTIN', '44184559L', '662974562', 'COCINERO', '2'),
('JUANITA', 'SANCHEZ GONZALEZ', '39267219S', '769874562', 'REPARTIDOR', '2'),
('LUIS', 'MART GINZA', '397651459Q', '779714562', 'COCINERO', '3'),
('CARLOS', 'MARTINEZ ZONGO', '539292746P', '662974562', 'REPARTIDOR', '1');


INSERT INTO CLIENTE (NOMBRE, APELLIDOS, DIRECCION, ID_LOCALIDAD, ID_PROVINCIA, TELEFONO)
VALUES
('MIREIA', 'ROMERO SAEZ', 'C/BERLIN 27', '03827', '03', '668562874'),
('MANUEL', 'AYALA FERNANDEZ', 'AV MERIDIANA', '08270', '08', '772554779'),
('TOMAS', 'MARTIN SANCHEZ', 'C/ROMA 88', '08270', '08', '654895123'),
('DAVID', 'LOPEZ LOPEZ', 'C/DIPUTACION 99', '43820', '43', '667885332');
INSERT INTO TIPO_DE_PRODUCTO(TIPO_DE_PRODUCTO)
VALUES
('PIZZAS'), ('HAMBUERGUESAS'), ('BEBIDAS');

INSERT INTO CATEGORIA_PIZZAS (NOMBRE)
VALUES
('FRESCAS'), ('BLANCAS'), ('CALZONE'), ('PICANTES');

INSERT INTO PRODUCTO (TIPO_DE_PRODUCTO, CATEGORIA, NOMBRE, DESCRIPCION, PRECIO)
VALUES
('1', '1', 'PIZZA DEL HUERTO', 'PIZZA FRESCA DE VEGETALES DEL HUERTO', '13.50'),
('1', '2', 'CARBONARA', 'PIZZA SALSA CARBONARA, CHAMPIÑONES Y BACON', '15.50'),
('1', '4', 'MEXICANA', 'PIZZA PICANTE AL ESTILO MEJICANO', '14.00')
;
INSERT INTO PRODUCTO (TIPO_DE_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO)
VALUES
('2', 'HAMBURGUESA INFIERNO', 'CARNE ANGUS DE 250G Y UN TOQUE PICANTE CON PATATAS A GAJOS', '15.00'),
('2', 'HAMBURGUESA COMPLETA', 'CARNE ANGUS DE 250G CON CEBOLLA Y BACON CON PATATAS A GAJOS', '14.00'),
('2', 'HAMBURGUESA MEXICANA', 'CARNE ANGUS DE 250G CON GUACAMOLE Y JALAPEÑOS CON PATATAS A GAJOS', '14.50'),
('3', 'FRESA', 'BATIDO DE FRESA', '3.50'),
('3', 'COLA', 'BEBIDA DE COLA', '2.50'),
('3', 'LIMON', 'BEBIDA DE LIMON', '2.50'),
('3', '7UP', 'BEBIDA DE LIMA LIMON', '3.00');

INSERT INTO CARRITO (ID_CLIENTE, ID_PEDIDO, ID_PRODUCTO, CANTIDAD)
VALUES
('1', '1','6', '1'),
('1', '1','10', '2'),
('2', '2','1', '1'),
('2', '2','5', '1'),
('2', '2','8', '1'),
('1', '3','4', '1'),
('1', '3','8', '3'); 

INSERT INTO PEDIDO (FECHA_HORA, ENTREGA_PEDIDO, TOTAL_HAMBURGUESAS, TOTAL_BEBIDAS, TOTAL_PIZZAS, PRECIO_TOTAL, ID_TIENDA, ID_CLIENTE)
VALUES 
('2022-01-05 15:40:45', 'DOMICILIO', '1', '2', '0', '17.50', '1', '1'),
('2022-01-05 16:34:15', 'RECOGER', '1', '1', '1', '30.00', '4', '2'),
('2022-01-05 21:50:25', 'DOMICILIO', '1', '3', '0', '17.50', '1', '1');

INSERT INTO REPARTO_PEDIDO (ID_PEDIDO, ID_TRABAJADOR, ID_CLIENTE, FECHA_HORA)
VALUES
('1', '1', '1', '2022-01-05 16:00:45'), ('3', '1', '1', '2022-01-05 22:10:45');

/* SELECT PEDIDO.ID_PEDIDO, PEDIDO.TOTAL_BEBIDAS, LOCALIDAD.NOMBRE FROM pedido INNER JOIN tienda ON PEDIDO.ID_TIENDA = TIENDA.ID_TIENDA
INNER JOIN LOCALIDAD ON TIENDA.ID_LOCALIDAD = LOCALIDAD.ID_LOCALIDAD WHERE LOCALIDAD.NOMBRE = 'NAVARCLES' */

SELECT PEDIDO.ID_PEDIDO, LOCALIDAD.NOMBRE, SUM(TOTAL_BEBIDAS) AS BEBIDAS_VENDIDAS FROM pedido INNER JOIN tienda ON PEDIDO.ID_TIENDA = TIENDA.ID_TIENDA
INNER JOIN LOCALIDAD ON TIENDA.ID_LOCALIDAD = LOCALIDAD.ID_LOCALIDAD WHERE LOCALIDAD.NOMBRE = 'NAVARCLES';

SELECT * FROM reparto_pedido INNER JOIN TRABAJADOR ON REPARTO_PEDIDO.ID_TRABAJADOR = TRABAJADOR.ID_TRABAJADOR WHERE TRABAJADOR.ID_TRABAJADOR = 1;